# Boiler Configuration
# This file configures the central boiler control and safety interlocks

boiler:
  # Boiler control entity
  # OpenTherm heating control via climate.turn_on/turn_off services
  entity_id: climate.opentherm_heating

  # OpenTherm mode
  # Note: The entity_id climate.opentherm_heating uses climate.turn_on/turn_off
  # No setpoint needed - the entity manages its own target temperature
  opentherm: boiler
  
  # Pump overrun handling
  # Boiler pump continues to run after heating stops to dissipate residual heat
  # TRVs must remain open during this period to allow water to flow
  pump_overrun_s: 150  # ~3 minutes (adjust after measuring actual boiler behavior)
  
  # Anti-short-cycling protection
  # Prevents rapid on/off cycles that damage the boiler and waste energy
  anti_cycling:
    # Minimum time boiler must stay ON once started (defautl 180 seconds)
    min_on_time_s: 180
    # Minimum time boiler must stay OFF once stopped (default 180 seconds)
    min_off_time_s: 180
    # Delay before turning off when demand stops (seconds)
    # Prevents cycling when users adjust setpoints or rooms briefly stop calling
    off_delay_s: 30
  
  # TRV-open interlock safety configuration
  # Ensures the boiler never runs without sufficient flow path available
  interlock:
    # Minimum total valve opening percentage required before boiler can turn on
    # Sum of all TRV open percentages must be >= this value
    # Default: 100 (ensures water always has somewhere to go)
    min_valve_open_percent: 100
  
  # Emergency safety room (fail-safe for hot water flow)
  # If boiler is ON but no rooms calling for heat, this room's valve will be
  # forced open to 100% to ensure there's a path for hot water.
  # This is a CRITICAL safety feature - never run boiler with all valves closed!
  safety_room: games  # Dining room - chosen as it's centrally located

  # Load sharing configuration
  # Intelligent load balancing to reduce short-cycling
  # Mode controlled via input_select.pyheat_load_sharing_mode in Home Assistant
  # load_sharing:
  #   min_calling_capacity_w: 2000  # Activate when calling capacity below this
  #   target_capacity_w: 2500       # Target total capacity to reach
  #   min_activation_duration_s: 300  # 5 minutes minimum (prevents oscillation)
  #   tier3_timeout_s: 900           # 15 minutes max for Tier 3 fallback rooms
  #   tier3_cooldown_s: 1800         # 30 minutes before room can be re-selected after timeout
  #   tier3_comfort_target_c: 20.0  # Comfort target for Tier 3 pre-warming (bypasses low parking temps)
  #   high_return_delta_c: 6         # Cycling risk: return temp within this many °C of setpoint
  #                                  # Tuned from analysis: 98% of cooldowns occur at delta <= 8°C
  #                                  # Oversized boiler runs stably at 5-6°C delta during normal heating
  #                                  # Example: if setpoint is 70°C, triggers at return >= 62°C
  load_sharing:
    min_calling_capacity_w: 2000      # Keep (bathroom is 415W, well below)
    target_capacity_w: 2500           # Keep
    min_activation_duration_s: 60     # REDUCE from 300 → 60s (1 min minimum)
    tier3_timeout_s: 180              # REDUCE from 900 → 180s (3 min instead of 15)
    tier3_cooldown_s: 300             # REDUCE from 1800 → 300s (5 min instead of 30)
    tier3_comfort_target_c: 20.0      # Keep
    high_return_delta_c: 6            # Keep
# Load monitoring configuration (for capacity estimation)
# Calculates estimated radiator heat output for load-based optimization
load_monitoring:
  enabled: true  # Set to false to disable load calculator
  system_delta_t: 10  # °C - typical flow-return temperature difference
  radiator_exponent: 1.3  # EN 442 heat transfer exponent (1.3 for panel radiators)
